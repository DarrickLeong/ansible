---
- name: Netbox VM Instance onboarding
  hosts: localhost
  gather_facts: false
  connection: local

  vars:
    netbox_url: "http://{{ netbox_endpoint }}:8000"  # Replace with your NetBox URL
    netbox_token: "{{ netbox_vault_token }}"  # Replace with your NetBox API token

  tasks:
    - name: "Ping the NetBox API"
      ansible.builtin.uri:
        url: "{{ netbox_url }}/api/"
        method: GET
        headers:
          Authorization: "Token {{ netbox_token }}"
          Content-Type: "application/json"
        validate_certs: false  # Set to 'true' if you have a valid SSL certificate
        status_code: 200       # We expect a successful HTTP 200 OK
      register: result

    - name: "Display Connection Status"
      ansible.builtin.debug:
        msg: "Successfully connected to NetBox! API version: {{ result }}"

    - name: gather ec2 instance variables
      amazon.aws.ec2_instance_info:
        region: ap-southeast-2
        filters:
          "instance-type": "t2.micro"
      register: ec2_info

    - name: print ec2_info
      debug:
        var: ec2_info
